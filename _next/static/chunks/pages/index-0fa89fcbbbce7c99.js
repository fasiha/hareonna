(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(t,n,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return e(7459)}])},7459:function(t,n,e){"use strict";e.r(n),e.d(n,{__N_SSG:function(){return W},default:function(){return G}});var r=e(5893),a=e(9008),i=e.n(a),o=e(4051),s=e.n(o),l=e(7294),c=e(6526),u=e(3325),h=e(4497),d=e(2846),f=e(6669),m=Math.PI,p=Math.sin,x=Math.cos,y=m/180;function v(t,n){var e=t[0]*y,r=t[1]*y,a=n[0]*y,i=a-e,o=n[1]*y-r;return Math.pow(p(.5*i),2)+Math.pow(p(.5*o),2)*x(e)*x(a)}var g=e(5152),j=e.n(g)()((function(){return Promise.all([e.e(269),e.e(705),e.e(747)]).then(e.bind(e,393))}),{loadableGenerated:{webpack:function(){return[393]}},ssr:!1});var w=function(){return(0,r.jsxs)("details",{id:"background",children:[(0,r.jsx)("summary",{children:"Click here for a little background behind this little app"}),(0,r.jsx)("p",{children:"I had often opened the Wikipedia page for various cities and inspected the table of monthly temperature lows and highs to get a sense of what the climate was like. This app is a generalization of that."}),(0,r.jsxs)("p",{children:["The details are on"," ",(0,r.jsx)("a",{href:"https://github.com/fasiha/hareonna/",children:"GitHub"})," but in a nutshell, I grabbed all ~13'500 global weather stations from the Global Historical Climatology Network daily (",(0,r.jsx)("a",{href:"https://www.ncei.noaa.gov/products/land-based-station/global-historical-climatology-network-daily",children:"GHCNd"}),") dataset that had temperature data over the last three years and looked at the temperature ",(0,r.jsx)("em",{children:"percentile"}),"s. I think percentiles are a more compact set of numbers to understand compared to the monthly averages Wikipedia has: the table below will have the specifics but a 50-percentile low means that half the days in the last three years were less than that value. A 10-percentile low means ~5 weeks of a year have lows lower than this, and a 90-percentile low means ~5 weeks per year have lows ",(0,r.jsx)("em",{children:"higher"})," than this."]}),(0,r.jsx)("p",{children:"So something I enjoy doing is,"}),(0,r.jsxs)("ol",{children:[(0,r.jsxs)("li",{children:["first select a weather station near my home (you can either search OpenStreetMap or just zoom around the map) and clicking"," ",(0,r.jsx)("button",{children:"Pick"}),"."]}),(0,r.jsxs)("li",{children:["Then find some ",(0,r.jsx)("em",{children:"other"})," faraway place and click"," ",(0,r.jsx)("button",{children:"Find similar"}),"."]})]}),(0,r.jsx)("p",{children:"That should get you started! And sorry, as you can tell from the buttons and the widgets and the cobbled-together nature of everything, this was thrown together in literally a weekend, but I hope you like it!"}),(0,r.jsxs)("p",{children:["(You might enjoy reading more about this app in my"," ",(0,r.jsx)("a",{href:"https://fasiha.github.io/post/hareonna-global-weather/",children:"blog post"})," ","about it. The name comes from Makoto Shinkai's film,"," ",(0,r.jsx)("em",{children:"Weathering with You"}),', originally \u300e\u5929\u6c17\u306e\u5b50\u300f, "weather child", where the eponymous child is called \u300c\u6674\u308c\u5973\u300d,'," ",(0,r.jsx)("a",{href:"https://jisho.org/search/\u6674\u308c\u5973",children:'"hareonna"'}),": a woman who brings good weather.)"]}),(0,r.jsx)("p",{onClick:function(){var t=document.querySelector("details#background");t&&(t.open=!1)},children:"\u25b2 Close background"})]})},b=e(8048);function S(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function k(t,n,e,r,a,i,o){try{var s=t[i](o),l=s.value}catch(c){return void e(c)}s.done?n(l):Promise.resolve(l).then(r,a)}function C(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var r,a,i=[],o=!0,s=!1;try{for(e=e.call(t);!(o=(r=e.next()).done)&&(i.push(r.value),!n||i.length!==n);o=!0);}catch(l){s=!0,a=l}finally{try{o||null==e.return||e.return()}finally{if(s)throw a}}return i}}(t,n)||T(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(t){return function(t){if(Array.isArray(t))return S(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||T(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(t,n){if(t){if("string"===typeof t)return S(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(e):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?S(t,n):void 0}}function P(t){var n=t.selectLocation,e=(0,l.useState)([]),a=e[0],i=e[1],o=(0,l.useState)(""),c=o[0],u=o[1],h=(0,l.useState)(""),d=h[0],f=h[1],m="fetching"===a?(0,r.jsx)(r.Fragment,{children:"Fetching\u2026"}):"error"===a?(0,r.jsx)(r.Fragment,{children:d}):(0,r.jsx)("ul",{children:a.map((function(t,e){return(0,r.jsxs)("li",{children:[(0,r.jsx)("button",{onClick:function(){return n(+t.lat,+t.lon)},children:"Zoom"})," ",t.display_name,": ",t.lat,"\xb0, ",t.lon,"\xb0"," "]},e)}))});return(0,r.jsxs)("div",{children:[(0,r.jsxs)("form",{onSubmit:function(){var t,n=(t=s().mark((function t(n){var e,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),i("fetching"),t.next=4,fetch("https://nominatim.openstreetmap.org/search?q=".concat(c,"&format=jsonv2"));case 4:if(!(e=t.sent).ok){t.next=12;break}return t.next=8,e.json();case 8:r=t.sent,i(r),t.next=13;break;case 12:f("Error encountered \ud83d\ude31: ".concat(e.status," ").concat(e.statusText)),i("error");case 13:case"end":return t.stop()}}),t)})),function(){var n=this,e=arguments;return new Promise((function(r,a){var i=t.apply(n,e);function o(t){k(i,r,a,o,s,"next",t)}function s(t){k(i,r,a,o,s,"throw",t)}o(void 0)}))});return function(t){return n.apply(this,arguments)}}(),children:[(0,r.jsx)("label",{children:"Search OpenStreetMap for: "}),(0,r.jsx)("input",{type:"text",size:35,placeholder:"city, country, neighborhood, mountain\u2026",value:c,onChange:function(t){return u(t.target.value)}})," ",(0,r.jsx)("button",{type:"submit",children:"Search"})]}),(0,r.jsx)("div",{children:m})]})}var F=function(t){return Math.round(365.25*t)},I=function(t){return Math.round(12*t)},_=new Map;function A(t,n){if(_.has(t))return _.get(t)||"";var e="";return e=0===t?"temp. min in ".concat(n," days"):1===t?"temp. max in ".concat(n," days"):t<.15?"temp. \u2264 this ".concat(F(t)," days/year"):t<.51?"temp. \u2264 this ".concat(I(t)," months/year"):1-t<.15?"temp. \u2265 this ".concat(F(1-t)," days/year"):"temp. \u2265 this ".concat(I(1-t)," months/year"),_.set(t,e),e}function E(t){return"\u2460\u2461\u2462\u2463\u2464\u2465\u2466\u2467\u2468\u2469\u246a\u246b\u246c\u246d\u246e\u246f\u2470\u2471\u2472\u2473\u3251\u3252\u3253\u3254\u3255\u3256\u3257\u3258\u3259\u325a\u325b\u325c\u325d\u325e\u325f\u32b1\u32b2\u32b3\u32b4\u32b5\u32b6\u32b7\u32b8\u32b9\u32ba\u32bb\u32bc\u32bd\u32be\u32bf"[t]||""+t}function O(t){var n,e,a=t.stationsInPage,i=t.pickedAndSimilarStations,o=t.numPicked,s=t.ps,c=t.deleteStation,m=t.setSimilarTo,p=t.selectLocation,x=t.setStation,y=(null===(e=a[0])||void 0===e?void 0:e.val.summary.days)||-1,v=new Map(i.map((function(t){return[t.name,"".concat(t.name,": ").concat(t.desc," (").concat(((n=Math).min.apply(n,M(t.summary.goods))/y*100).toFixed(1),"% good data over ").concat(y," days)")]}))),g=new Set(a.map((function(t){return t.val.name}))),j=(0,l.useState)(640),w=j[0],b=j[1],S=(0,l.useRef)(null);return(0,l.useEffect)((function(){if(0!==a.length){var t=a.flatMap((function(t,n){var e=t.val,r=t.valIdx;return e.summary.his.map((function(t,n){return{hi:t,lo:e.summary.lows[n],p:100*s[n],station:"".concat(E(r)," ").concat(e.desc.replaceAll(/\s+/g," "))}}))})),n=u.g({width:w,height:"300",y:{grid:!0,label:"\u2191 \xb0C"},x:{label:"percentile \u2192"},facet:{data:t,x:"station"},marks:[h.VD([10,20,30]),d.C7(t.filter((function(n){return n.station===t[0].station})),{x:"p",y:"lo",y2:"hi",fillOpacity:.25,fill:"station",facet:!1}),d.C7(t,{x:"p",y:"lo",y2:"hi",fillOpacity:.5,fill:"station"}),f.$w(t,{x:"p",y:"lo",marker:"circle",stroke:"station",strokeWidth:1}),f.$w(t,{x:"p",y:"hi",marker:"circle",stroke:"station",strokeWidth:1})]});return S.current.append(n),function(){n.remove()}}}),[a,w]),0===a.length?(0,r.jsx)("p",{children:"(Waiting for you to pick some weather stations.)"}):(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{width:"100%"},ref:S}),(0,r.jsxs)("p",{children:["(Tweak width: ",(0,r.jsx)("button",{onClick:function(){return b(w+100)},children:"+"})," ",(0,r.jsx)("button",{onClick:function(){return b(w-100)},children:"-"}),")"]}),(0,r.jsx)("ol",{children:i.map((function(t,n){return(0,r.jsxs)("li",{className:(g.has(t.name)?"shown-station":"not-shown-station")+(n===o?" first-similar-to":""),children:[n>=o&&"#".concat(n-o+1," Similar: "),v.get(t.name)," ",n<o?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:function(){return c(t.name)},children:"Delete"})," "]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:function(){return x(t)},children:"Pick"})," "]}),(0,r.jsx)("button",{onClick:function(){return m(t)},children:"Find similar"})," ",(0,r.jsx)("button",{onClick:function(){return p(t.lat,t.lon)},children:"Zoom"})]},t.name+(n<o))}))}),(0,r.jsxs)("table",{children:[(0,r.jsxs)("thead",{children:[(0,r.jsxs)("tr",{children:[(0,r.jsxs)("th",{rowSpan:2,children:["%",(0,r.jsx)("sub",{children:"ile"})]}),a.map((function(t){var n=t.val,e=t.valIdx;return(0,r.jsxs)("th",{colSpan:2,title:v.get(n.name),children:[E(e)," ",(0,r.jsx)("button",{onClick:function(){return c(n.name)},children:"x"})]},n.name+(e<o))})),(0,r.jsx)("th",{rowSpan:2,children:"(notes)"})]}),(0,r.jsx)("tr",{children:a.map((function(t,n){return(0,r.jsxs)(l.Fragment,{children:[(0,r.jsx)("th",{children:"Low"}),(0,r.jsx)("th",{children:"High"})]},n)}))})]}),(0,r.jsx)("tbody",{children:s.map((function(t,n){return(0,r.jsxs)("tr",{children:[(0,r.jsxs)("td",{children:[(100*t).toFixed(1),"%"]}),a.map((function(t){var e=t.val,a=t.valIdx;return(0,r.jsxs)(l.Fragment,{children:[(0,r.jsxs)("td",{children:[e.summary.lows[n]," \xb0C"]}),(0,r.jsxs)("td",{children:[e.summary.his[n]," \xb0C"]})]},e.name+(a<o))})),(0,r.jsx)("td",{children:A(t,y)})]},t)}))})]})]})}var N={numToShow:0,targetStation:void 0,similarStations:[]};function H(t){var n=t.stationsPayload,e=function(t){var n=k+t;n<=1?M(1):n>=T.length-1?M(T.length-1):M(n)},a=(0,l.useMemo)((function(){return t=n.stations,new c.kdTree(t,(function(t,n){return v([t.lat,t.lon],[n.lat,n.lon])}),["lat","lon"]);var t}),[]),i=(0,l.useState)([]),o=i[0],s=i[1],u=(0,l.useState)({center:[0,0],pointsToFit:[]}),h=u[0],d=u[1],f=(0,l.useState)(N),m=f[0],p=f[1],x=(0,l.useState)(5),y=x[0],g=x[1],S=(0,l.useState)(1),k=S[0],M=S[1],T=(0,l.useMemo)((function(){return o.concat(m.similarStations.slice(0,m.numToShow))}),[o,m]),F=(0,l.useMemo)((function(){return function(t,n,e){if(0===t.length)return[];var r=t[0];e=Math.max(e,1);var a=t.slice(e,e+n-1),i=[r].concat(a),o=[0].concat(a.map((function(t,n){return n+e})));return i.map((function(t,n){return{val:t,valIdx:o[n]}}))}(T,y,k)}),[y,k,T]),I=(0,l.useCallback)((function(t){var e,r=(null===(e=m.targetStation)||void 0===e?void 0:e.name)===t.name,a=r?m.similarStations:function(t){var n=t.targetStation,e=t.stations,r=t.ps,a=t.indexes,i=void 0===a?[]:a,o=function(t,n,e){var r=0,a=!0,i=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,u=c.low,h=c.idx;r+=u?Math.pow(t.summary.lows[h]-n.summary.lows[h],2):Math.pow(t.summary.his[h]-n.summary.his[h],2)}}catch(d){i=!0,o=d}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}return r};if(0===i.length){i=[];var s=!0,l=!1,c=void 0;try{for(var u,h=r.entries()[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=C(u.value,2),f=d[0],m=d[1];.1!==m&&.9!==m||(i.push({low:!0,idx:f}),i.push({low:!1,idx:f}))}}catch(p){l=!0,c=p}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}}return e.slice().sort((function(t,e){return o(t,n,i)-o(e,n,i)})).slice(1)}({targetStation:t,stations:n.stations,ps:n.percentiles}),i=(r?m.numToShow:0)+20;p({numToShow:i,targetStation:t,similarStations:a}),d({center:(0,b.J)(t),pointsToFit:a.slice(0,i).map(b.J)}),s((function(n){return n.find((function(n){return n.name===t.name}))?n:n.concat(t)}))}),[p,s,d,m]);return(0,l.useEffect)((function(){var t=window.location.hash.replace(/^#*/,"").split(",").filter((function(t){return t.startsWith("s:")})).map((function(t){return t.slice(2)}));if(t.length){var e=new Map(t.map((function(t,n){return[t,n]}))),r=[],a=!0,i=!1,o=void 0;try{for(var l,c=n.stations[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value,h=e.get(u.name);void 0!==h&&(r[h]=u)}}catch(d){i=!0,o=d}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}s(r.filter((function(t){return!!t})))}}),[]),(0,l.useEffect)((function(){var t;(t=o).length&&(window.location.hash=t.map((function(t){return"s:"+t.name})).join(","))}),[o]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h1",{children:"Hareonna"}),(0,r.jsx)(w,{}),(0,r.jsx)("h2",{children:"(Optional: Search for a place)"}),(0,r.jsx)(P,{selectLocation:function(t,n){var e=a.nearest({lat:t,lon:n},5);d({center:[t,n],pointsToFit:e.map((function(t){var n=C(t,1)[0];return[n.lat,n.lon]}))})}}),(0,r.jsx)("h2",{children:"Or: Click on a weather station and pick it"}),(0,r.jsx)(j,{setSimilarTo:function(t){return I(t)},setStation:function(t){s((function(n){return n.find((function(n){return n.name===t.name}))?n:n.concat(t)}))},camera:h,stationsPayload:n,stationsInPage:F,pickedAndSimilarStations:T,numPicked:o.length,targetStation:m.targetStation}),(0,r.jsx)("h2",{children:"Visualization of high/low temperature percentiles"}),(0,r.jsxs)("p",{children:[(0,r.jsx)("button",{disabled:k<=1,onClick:function(){return e(-(y-1))},title:"Jump back",children:"\u21c7"})," ",(0,r.jsx)("button",{disabled:k<=1,onClick:function(){return e(-1)},title:"Step back one",children:"\u2190"})," ","|"," ",(0,r.jsx)("button",{disabled:k>=T.length-1,onClick:function(){return e(1)},title:"Step ahead one",children:"\u2192"})," ",(0,r.jsx)("button",{disabled:k>=T.length-1,onClick:function(){return e(y-1)},title:"Jump ahead",children:"\u21c9"})," ",(0,r.jsx)("label",{htmlFor:"nPerPage",children:"Stations to show at once? "}),(0,r.jsx)("input",{id:"nPerPage",type:"number",min:2,value:y,onChange:function(t){return g(Math.max(2,+t.target.value))}})," ",(0,r.jsx)("button",{disabled:0===o.length,onClick:function(){s([]),p(N)},children:"Delete all!"})," ",(0,r.jsx)("button",{disabled:!m.targetStation,onClick:function(){return p(N)},children:"Clear similar"})]}),(0,r.jsx)(O,{stationsInPage:F,pickedAndSimilarStations:T,numPicked:o.length,ps:n.percentiles,deleteStation:function(t){return s((function(n){return n.filter((function(n){return n.name!==t}))}))},setSimilarTo:function(t){return I(t)},selectLocation:function(t,n){var e=a.nearest({lat:t,lon:n},3);d({center:[t,n],pointsToFit:e.map((function(t){var n=C(t,1)[0];return[n.lat,n.lon]}))})},setStation:function(t){s((function(n){return n.find((function(n){return n.name===t.name}))?n:n.concat(t)}))}}),(0,r.jsx)("p",{children:(0,r.jsxs)("small",{children:[(0,r.jsx)("a",{href:"https://github.com/fasiha/hareonna/",children:"Source"})," on GitHub"]})})]})}var W=!0;function G(t){var n=t.stationsPayload;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(i(),{children:[(0,r.jsx)("title",{children:"Hareonna"}),(0,r.jsx)("link",{rel:"icon",href:"data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>\ud83c\udf24</text></svg>"}),(0,r.jsx)("meta",{name:"viewport",content:"initial-scale=1.0, width=device-width"}),(0,r.jsx)("meta",{property:"og:title",content:"Hareonna\u2014look at the percentiles of thousands of weather stations\u2019 lows and highs"},"title")]}),(0,r.jsx)(H,{stationsPayload:n})]})}},8048:function(t,n,e){"use strict";e.d(n,{J:function(){return r}});var r=function(t){return[t.lat,t.lon]}}},function(t){t.O(0,[595,774,888,179],(function(){return n=8312,t(t.s=n);var n}));var n=t.O();_N_E=n}]);